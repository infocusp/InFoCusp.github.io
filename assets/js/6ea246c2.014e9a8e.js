"use strict";(self.webpackChunkinfocusp_blog=self.webpackChunkinfocusp_blog||[]).push([[1262],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=i.createContext({}),s=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=s(e.components);return i.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=s(n),f=a,u=d["".concat(p,".").concat(f)]||d[f]||m[f]||r;return n?i.createElement(u,o(o({ref:t},c),{},{components:n})):i.createElement(u,o({ref:t},c))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=d;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var s=2;s<r;s++)o[s]=n[s];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},802:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var i=n(7462),a=(n(7294),n(3905));const r={slug:"pygit2",title:"pygit2",authors:["jayendra","preet","cheris"],tags:["python","git"]},o=void 0,l={permalink:"/blog/pygit2",editUrl:"https://github.com/InFoCusp/infocusp-blog/tree/main/blog/2022-10-15-pygit2/index.md",source:"@site/blog/2022-10-15-pygit2/index.md",title:"pygit2",description:"Introduction",date:"2022-10-15T00:00:00.000Z",formattedDate:"October 15, 2022",tags:[{label:"python",permalink:"/blog/tags/python"},{label:"git",permalink:"/blog/tags/git"}],readingTime:2.66,hasTruncateMarker:!1,authors:[{name:"Jayendra Parmar",title:"Software Engineer @ Infocusp",url:"https://sebastienlorber.com",imageURL:"https://avatars.githubusercontent.com/u/651057?v=4",key:"jayendra"},{name:"Preet Patel",title:"Software Engineer @ Infocusp",url:"https://sebastienlorber.com",imageURL:"https://avatars.githubusercontent.com/u/105536384?v=4",key:"preet"},{name:"Cheris Patel",title:"Software Engineer @ Infocusp",url:"https://sebastienlorber.com",imageURL:"https://avatars.githubusercontent.com/u/651058?v=4",key:"cheris"}],frontMatter:{slug:"pygit2",title:"pygit2",authors:["jayendra","preet","cheris"],tags:["python","git"]},nextItem:{title:"Awesome ML resources",permalink:"/blog/awesome-ml-resources"}},p={authorsImageUrls:[void 0,void 0,void 0]},s=[{value:"Introduction",id:"introduction",level:2},{value:"Features of pygit2",id:"features-of-pygit2",level:2},{value:"Installation",id:"installation",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Initialize empty git repository",id:"initialize-empty-git-repository",level:3},{value:"Clone the repository",id:"clone-the-repository",level:3},{value:"Opening existing repository",id:"opening-existing-repository",level:3},{value:"Add and commit changes",id:"add-and-commit-changes",level:3},{value:"Get head commit",id:"get-head-commit",level:3},{value:"Check diff of the commit",id:"check-diff-of-the-commit",level:3},{value:"Iterate over all objects",id:"iterate-over-all-objects",level:3},{value:"Iterate over all files of commit",id:"iterate-over-all-files-of-commit",level:3}],c={toc:s};function m(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://git-scm.com/images/logos/downloads/Git-Logo-2Color.svg",alt:"git"})),(0,a.kt)("p",null,"Git treats each files as blob object and directory as a tree. Each and every objects are stored as pack files in compressed format in the .git directory. Every pack file will have index ('.idx') file. Index file contains metadata about object and it has the entry of object and where its stored."),(0,a.kt)("p",null,"pygit2 is the way to communicate with .git directory the way git command does."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://pypi.org/project/pygit2/"},"PYPI_PACKAGE DOCUMENTATION")),(0,a.kt)("p",null,"Pygit2 is python wrapper to run git functionality via python program. It is build on top of the libgit2. ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/libgit2/libgit2"},"libgit2")," is a pure C implementation of the Git core methods that enables you to integrate Git functionality into your program."),(0,a.kt)("h2",{id:"features-of-pygit2"},"Features of pygit2"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Important for dataset gathering of multiple git repositories.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"We can get any commit, file, metadata from the repository."))),(0,a.kt)("li",{parentName:"ul"},"Easy to code as it is in python."),(0,a.kt)("li",{parentName:"ul"},"(>10x) Faster than other available git wrappers like ",(0,a.kt)("a",{parentName:"li",href:"https://pypi.org/project/GitPython/"},"GitPython")," or ",(0,a.kt)("a",{parentName:"li",href:"https://pypi.org/project/python-git-wrapper/"},"python-git-wrapper"),".")),(0,a.kt)("h2",{id:"installation"},"Installation"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pip install pygit2\n")),(0,a.kt)("h2",{id:"implementation"},"Implementation"),(0,a.kt)("h3",{id:"initialize-empty-git-repository"},"Initialize empty git repository"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"from pygit2 import init_repository\nrepo = init_repository('my_folder/test', bare=False)\n")),(0,a.kt)("h3",{id:"clone-the-repository"},"Clone the repository"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"import pygit2\nrepoClone = pygit2.clone_repository('https://github.com/Preet-786/test.git', 'my_folder/test')\n")),(0,a.kt)("h3",{id:"opening-existing-repository"},"Opening existing repository"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"from pygit2 import Repository\nrepo = Repository('my_folder/test')\n")),(0,a.kt)("h3",{id:"add-and-commit-changes"},"Add and commit changes"),(0,a.kt)("p",null,"After modifying the files"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'repo.index.add_all()\nrepo.index.write()\ntree = repo.index.write_tree()\nparent, ref = repo.resolve_refish(refish=repo.head.name)\nrepo.create_commit(\n    ref.name,\n    repo.default_signature,\n    repo.default_signature,\n    "Commit message",\n    tree,\n    [parent.oid],\n)\n')),(0,a.kt)("h3",{id:"get-head-commit"},"Get head commit"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"head = repo.head\nprint(f'CommitId:{head.target}, Branch:{head.name}')\nmsg = head.log().__next__()\nprint(f'Commit message: {msg.message}')\nprint(f'Commiter: {msg.committer}')\n")),(0,a.kt)("p",null,"Results:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"CommitId:08d8b7f0de4575fc9dfe9da5157e000157630ae0, Branch:refs/heads/main\nCommit message: commit: Commit message\nCommiter: preet <preetpatel.nu@gmail.com>\n")),(0,a.kt)("h3",{id:"check-diff-of-the-commit"},"Check diff of the commit"),(0,a.kt)("p",null,"We can get patch diff of the commit"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"commit_id = repo.head.target\n\n# we can get object from it's id\ncommit_obj = repo.get(commit_id)\n\ndiff_obj = repo.diff(commit_obj, commit_obj.parents[0])\nprint(diff_obj.patch)\n")),(0,a.kt)("p",null,"Result:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"diff --git a/ini.py b/ini.py\ndeleted file mode 100644\nindex 8909c17..0000000\n--- a/ini.py\n+++ /dev/null\n@@ -1 +0,0 @@\n-hii\n\\ No newline at end of file\n")),(0,a.kt)("p",null,"We can see the files which are changed during commit"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'commit_id = repo.head.target\n\n# we can get object from it\'s id\ncommit_obj = repo.get(commit_id)\n\n# We can insert two commit ids also in diff\ndiff_obj = repo.diff(commit_obj.parents[0], commit_obj)\n\nfor delta in diff_obj.deltas:\n    # Status: M=modified, A=added, D=Deleted\n    print("Status: ",delta.status_char())\n    print(f"Old File:\\nPath: {delta.old_file.path}\\nData: {repo.get(delta.old_file.id).data}\\n")\n    print(f"New File:\\nPath: {delta.new_file.path}\\nData: {repo.get(delta.new_file.id).data}\\n")\n')),(0,a.kt)("p",null,"Result:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"Status:  M\nOld File:\nPath: ini.py\nData: b'hii'\n\nNew File:\nPath: ini.py\nData: b'hii\\nnewly added line'\n")),(0,a.kt)("h3",{id:"iterate-over-all-objects"},"Iterate over all objects"),(0,a.kt)("p",null,"There are three type of objects"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Commit: Commit object contains File structure, diff, patch everything regarding commit"),(0,a.kt)("li",{parentName:"ol"},"Blob: It contains objects of files."),(0,a.kt)("li",{parentName:"ol"},"Tree: It refers to directory of repo")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"for obj_id in repo:\n    obj = repo.get(obj_id)\n    print(f'Object id: {obj.id}, Object type: {obj.type_str}')\n")),(0,a.kt)("p",null,"Results:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"Object id: 2bee0c854238d42b2ad1ec27e615a0ea675771b6, Object type: commit\nObject id: 4113e3ac744218e9f702ad0bb5313d4c8d79b03c, Object type: tree\nObject id: 32d328df61352fe95e90dc9342d2f85d2fb07f86, Object type: blob\nObject id: f54fe20e4975b4934ff5cdf75ce54d1ddb122894, Object type: tree\nObject id: 04a5899b6f9c0ccd381aaa039b098eaceb5a2f01, Object type: blob\n.\n.\n")),(0,a.kt)("h3",{id:"iterate-over-all-files-of-commit"},"Iterate over all files of commit"),(0,a.kt)("p",null,"We can iterate over all files from the commit object. And we can recursively traverse files and it's contents via directory present in the commit."))}m.isMDXComponent=!0}}]);